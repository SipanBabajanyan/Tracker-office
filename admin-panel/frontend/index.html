<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In Office - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 8px;
        }

        .header p {
            color: #718096;
            font-size: 1.1em;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .period-selector {
            display: flex;
            gap: 8px;
        }

        .period-btn {
            padding: 10px 20px;
            border: 2px solid #e2e8f0;
            background: white;
            color: #4a5568;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .period-btn.active {
            background: #3182ce;
            color: white;
            border-color: #3182ce;
        }

        .period-btn:hover {
            border-color: #3182ce;
            color: #3182ce;
        }

        .refresh-btn {
            background: #38a169;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .refresh-btn:hover {
            background: #2f855a;
            transform: translateY(-1px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2.8em;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #718096;
            font-size: 1em;
            font-weight: 500;
        }

        .employees-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 20px;
        }

        .employee-list {
            display: grid;
            gap: 16px;
        }

        .employee-item {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .employee-item:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
            transform: translateY(-1px);
        }

        .employee-info h3 {
            color: #1a202c;
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .employee-info p {
            color: #718096;
            font-size: 0.9em;
            margin: 2px 0;
        }

        .time-info {
            text-align: right;
        }

        .total-time {
            font-size: 1.4em;
            font-weight: 700;
            color: #38a169;
            margin-bottom: 4px;
        }

        .last-seen {
            color: #a0aec0;
            font-size: 0.85em;
            margin-bottom: 8px;
        }

        .employee-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-in-office {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-out-office {
            background: #fed7d7;
            color: #742a2a;
        }

        .export-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .export-btn {
            background: #3182ce;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            margin: 0 8px;
            transition: all 0.2s ease;
        }

        .export-btn:hover {
            background: #2c5aa0;
            transform: translateY(-1px);
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #a0aec0;
            font-size: 1.1em;
        }

        .employee-name {
            cursor: pointer;
            border-bottom: 1px dashed #cbd5e0;
            transition: all 0.2s ease;
        }

        .employee-name:hover {
            border-bottom-color: #3182ce;
            color: #3182ce;
        }

        .employee-name input {
            border: 2px solid #3182ce;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 1.2em;
            font-weight: 600;
            color: #1a202c;
            background: white;
        }

        .employee-name input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }

        .back-btn {
            background: #e2e8f0;
            color: #4a5568;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            margin-bottom: 20px;
        }

        .back-btn:hover {
            background: #cbd5e0;
        }

        .employee-detail {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .employee-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }

        .employee-title {
            font-size: 1.8em;
            font-weight: 600;
            color: #1a202c;
        }

        .history-grid {
            display: grid;
            gap: 16px;
        }

        .history-item {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-date {
            font-weight: 600;
            color: #1a202c;
            font-size: 1.1em;
        }

        .history-time {
            color: #38a169;
            font-weight: 600;
            font-size: 1.2em;
        }

        .history-status {
            padding: 4px 12px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.8em;
            text-transform: uppercase;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
        <div id="mainPage">
            <div class="header">
                <h1>üè¢ In Office</h1>
                <p>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –æ—Ñ–∏—Å–µ</p>
            </div>

            <div class="controls">
                <div class="period-selector">
                    <button class="period-btn active" onclick="setPeriod('today')">–°–µ–≥–æ–¥–Ω—è</button>
                    <button class="period-btn" onclick="setPeriod('week')">–ù–µ–¥–µ–ª—è</button>
                    <button class="period-btn" onclick="setPeriod('month')">–ú–µ—Å—è—Ü</button>
                    <button class="period-btn" onclick="setPeriod('year')">–ì–æ–¥</button>
                </div>
                <button class="refresh-btn" onclick="refreshData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalEmployees">-</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="inOfficeNow">-</div>
                    <div class="stat-label">–í –æ—Ñ–∏—Å–µ —Å–µ–π—á–∞—Å</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgTimeToday">-</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è (—á)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalTimeToday">-</div>
                    <div class="stat-label">–û–±—â–µ–µ –≤—Ä–µ–º—è (—á)</div>
                </div>
            </div>

            <div class="employees-section">
                <h2 class="section-title">üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h2>
                <p style="color: #718096; margin-bottom: 20px;">
                    –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, —á—Ç–æ–±—ã –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é.
                </p>
                <div id="employeesList" class="employee-list">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
                </div>
            </div>

            <div class="export-section">
                <h2 class="section-title">üìä –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h2>
                <button class="export-btn" onclick="exportToExcel()">üìà Excel</button>
                <button class="export-btn" onclick="exportToCSV()">üìÑ CSV</button>
                <button class="export-btn" onclick="exportReport()">üìã –û—Ç—á–µ—Ç</button>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
        <div id="employeePage" class="hidden">
            <button class="back-btn" onclick="showMainPage()">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</button>
            
            <div class="employee-detail">
                <div class="employee-header">
                    <h2 class="employee-title" id="employeeDetailTitle">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</h2>
                    <div class="period-selector">
                        <button class="period-btn active" onclick="setEmployeePeriod('today')">–°–µ–≥–æ–¥–Ω—è</button>
                        <button class="period-btn" onclick="setEmployeePeriod('week')">–ù–µ–¥–µ–ª—è</button>
                        <button class="period-btn" onclick="setEmployeePeriod('month')">–ú–µ—Å—è—Ü</button>
                        <button class="period-btn" onclick="setEmployeePeriod('year')">–ì–æ–¥</button>
                    </div>
                </div>
                
                <div id="employeeHistory" class="history-grid">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ
        let employeesData = [];
        let currentPeriod = 'today';
        let currentEmployee = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        async function loadData() {
            try {
                const response = await fetch('/api/employees');
                employeesData = await response.json();
                updateEmployeesList();
                updateStats();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                // –î–µ–º–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                employeesData = [
                    {
                        id: 1,
                        name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤',
                        deviceId: 'device_001',
                        isInOffice: true,
                        startTime: '09:00',
                        totalTimeToday: '7:30',
                        lastSeen: '2 –º–∏–Ω—É—Ç—ã –Ω–∞–∑–∞–¥'
                    },
                    {
                        id: 2,
                        name: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞',
                        deviceId: 'device_002',
                        isInOffice: false,
                        startTime: null,
                        totalTimeToday: '6:15',
                        lastSeen: '15 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥'
                    },
                    {
                        id: 3,
                        name: '–ê–ª–µ–∫—Å–µ–π –ö–æ–∑–ª–æ–≤',
                        deviceId: 'device_003',
                        isInOffice: true,
                        startTime: '08:30',
                        totalTimeToday: '8:45',
                        lastSeen: '1 –º–∏–Ω—É—Ç—É –Ω–∞–∑–∞–¥'
                    }
                ];
                updateEmployeesList();
                updateStats();
            }
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–∏–æ–¥–∞
        function setPeriod(period) {
            currentPeriod = period;
            document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateStats();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const totalEmployees = employeesData.length;
            const inOfficeNow = employeesData.filter(emp => emp.isInOffice).length;
            const avgHours = (totalEmployees > 0 ? 7.5 : 0).toFixed(1);
            const totalHours = (totalEmployees * 7.5).toFixed(1);

            document.getElementById('totalEmployees').textContent = totalEmployees;
            document.getElementById('inOfficeNow').textContent = inOfficeNow;
            document.getElementById('avgTimeToday').textContent = avgHours;
            document.getElementById('totalTimeToday').textContent = totalHours;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        function updateEmployeesList() {
            const container = document.getElementById('employeesList');
            
            if (employeesData.length === 0) {
                container.innerHTML = '<div class="loading">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö</div>';
                return;
            }

            container.innerHTML = employeesData.map(employee => `
                <div class="employee-item" onclick="showEmployeeDetail(${employee.id})">
                    <div class="employee-info">
                        <h3>
                            <span class="employee-name" onclick="event.stopPropagation(); editEmployeeName(${employee.id})">
                                ${employee.name || '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∏–º—è'}
                            </span>
                        </h3>
                        <p>ID: <strong>${employee.deviceId}</strong></p>
                        ${employee.startTime ? `<p>–ù–∞—á–∞–ª–æ: ${employee.startTime}</p>` : ''}
                    </div>
                    <div class="time-info">
                        <div class="total-time">${employee.totalTimeToday}</div>
                        <div class="last-seen">${employee.lastSeen}</div>
                        <div class="employee-status ${employee.isInOffice ? 'status-in-office' : 'status-out-office'}">
                            ${employee.isInOffice ? '–í –û–§–ò–°–ï' : '–í–ù–ï –û–§–ò–°–ê'}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        function editEmployeeName(employeeId) {
            const nameElement = document.querySelector(`#name-${employeeId}`);
            if (!nameElement) return;
            
            const currentName = nameElement.textContent;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentName === '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∏–º—è' ? '' : currentName;
            input.placeholder = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é';
            
            nameElement.innerHTML = '';
            nameElement.appendChild(input);
            input.focus();
            input.select();
            
            const saveName = () => {
                const newName = input.value.trim();
                if (newName) {
                    updateEmployeeName(employeeId, newName);
                } else {
                    nameElement.textContent = currentName;
                }
            };
            
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    saveName();
                }
            });
            
            input.addEventListener('blur', saveName);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
        async function updateEmployeeName(employeeId, newName) {
            try {
                const response = await fetch(`/api/employees/${employeeId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name: newName })
                });
                
                if (response.ok) {
                    const employee = employeesData.find(emp => emp.id === employeeId);
                    if (employee) {
                        employee.name = newName;
                    }
                    
                    const nameElement = document.querySelector(`#name-${employeeId}`);
                    if (nameElement) {
                        nameElement.textContent = newName;
                    }
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–º–µ–Ω–∏');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–º–µ–Ω–∏');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        function showEmployeeDetail(employeeId) {
            currentEmployee = employeesData.find(emp => emp.id === employeeId);
            if (!currentEmployee) return;

            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('employeePage').classList.remove('hidden');
            
            document.getElementById('employeeDetailTitle').textContent = currentEmployee.name;
            loadEmployeeHistory();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        function showMainPage() {
            document.getElementById('employeePage').classList.add('hidden');
            document.getElementById('mainPage').classList.remove('hidden');
            currentEmployee = null;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        function loadEmployeeHistory() {
            const container = document.getElementById('employeeHistory');
            
            // –î–µ–º–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
            const historyData = [
                { date: '2024-12-19', time: '8—á 30–º', status: '–í –æ—Ñ–∏—Å–µ' },
                { date: '2024-12-18', time: '7—á 45–º', status: '–í –æ—Ñ–∏—Å–µ' },
                { date: '2024-12-17', time: '6—á 15–º', status: '–í–Ω–µ –æ—Ñ–∏—Å–∞' },
                { date: '2024-12-16', time: '8—á 00–º', status: '–í –æ—Ñ–∏—Å–µ' },
                { date: '2024-12-15', time: '7—á 20–º', status: '–í –æ—Ñ–∏—Å–µ' }
            ];

            container.innerHTML = historyData.map(day => `
                <div class="history-item">
                    <div class="history-date">${day.date}</div>
                    <div class="history-time">${day.time}</div>
                    <div class="history-status ${day.status === '–í –æ—Ñ–∏—Å–µ' ? 'status-in-office' : 'status-out-office'}">
                        ${day.status}
                    </div>
                </div>
            `).join('');
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–∏–æ–¥–∞ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        function setEmployeePeriod(period) {
            document.querySelectorAll('#employeePage .period-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            loadEmployeeHistory();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function refreshData() {
            document.getElementById('employeesList').innerHTML = 
                '<div class="loading">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</div>';
            loadData();
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportToExcel() {
            alert('–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω');
        }

        function exportToCSV() {
            alert('–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω');
        }

        function exportReport() {
            alert('–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω');
        }
    </script>
</body>
</html>